<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lu·ªìng thanh to√°n Crypto qua MetaMask</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
            text-align: center;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 16px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: #667eea;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .flow-diagram {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
        }
        
        .flow-step {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            position: relative;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .step-number {
            flex-shrink: 0;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .step-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .step-actors {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .actor {
            padding: 5px 12px;
            background: white;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            border: 2px solid #e9ecef;
        }
        
        .actor.frontend {
            border-color: #007bff;
            color: #007bff;
        }
        
        .actor.metamask {
            border-color: #f6851b;
            color: #f6851b;
        }
        
        .actor.blockchain {
            border-color: #28a745;
            color: #28a745;
        }
        
        .actor.backend {
            border-color: #6f42c1;
            color: #6f42c1;
        }
        
        .code-example {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin-top: 15px;
        }
        
        .architecture {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .component {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .component:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .component.frontend {
            border-color: #007bff;
        }
        
        .component.metamask {
            border-color: #f6851b;
        }
        
        .component.blockchain {
            border-color: #28a745;
        }
        
        .component.backend {
            border-color: #6f42c1;
        }
        
        .component-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .component-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .component-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }
        
        .arrow {
            text-align: center;
            font-size: 30px;
            color: #667eea;
            margin: 10px 0;
        }
        
        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .note-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 8px;
        }
        
        .note-content {
            color: #856404;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .timeline {
            position: relative;
            padding-left: 40px;
            margin: 30px 0;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            padding-left: 30px;
        }
        
        .timeline-dot {
            position: absolute;
            left: -33px;
            top: 5px;
            width: 15px;
            height: 15px;
            background: #667eea;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 0 3px #667eea;
        }
        
        .timeline-content {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        
        .timeline-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .timeline-desc {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .comparison-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            color: #666;
        }
        
        .comparison-table tr:last-child td {
            border-bottom: none;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Lu·ªìng thanh to√°n Crypto qua MetaMask</h1>
        <p class="subtitle">Hi·ªÉu r√µ c√°ch ho·∫°t ƒë·ªông ƒë·ªÉ t√≠ch h·ª£p hi·ªáu qu·∫£</p>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('overview')">T·ªïng quan</button>
            <button class="tab" onclick="switchTab('detailed-flow')">Lu·ªìng chi ti·∫øt</button>
            <button class="tab" onclick="switchTab('architecture')">Ki·∫øn tr√∫c</button>
            <button class="tab" onclick="switchTab('comparison')">So s√°nh ph∆∞∆°ng th·ª©c</button>
        </div>
        
        <!-- Tab 1: T·ªïng quan -->
        <div id="overview" class="tab-content active">
            <h2 style="margin-bottom: 20px; color: #333;">üìä Ki·∫øn tr√∫c t·ªïng quan</h2>
            
            <div class="architecture">
                <div class="component frontend">
                    <div class="component-icon">üñ•Ô∏è</div>
                    <div class="component-title">Website c·ªßa b·∫°n</div>
                    <div class="component-desc">
                        Giao di·ªán checkout, t√≠ch h·ª£p Web3.js/Ethers.js, hi·ªÉn th·ªã gi√° crypto realtime
                    </div>
                </div>
                
                <div class="component metamask">
                    <div class="component-icon">ü¶ä</div>
                    <div class="component-title">MetaMask Wallet</div>
                    <div class="component-desc">
                        V√≠ crypto c·ªßa ng∆∞·ªùi d√πng, qu·∫£n l√Ω private key, k√Ω giao d·ªãch
                    </div>
                </div>
                
                <div class="component blockchain">
                    <div class="component-icon">‚õìÔ∏è</div>
                    <div class="component-title">Blockchain Network</div>
                    <div class="component-desc">
                        Ethereum/BSC/Polygon, x·ª≠ l√Ω giao d·ªãch, l∆∞u tr·ªØ b·∫•t bi·∫øn
                    </div>
                </div>
                
                <div class="component backend">
                    <div class="component-icon">‚öôÔ∏è</div>
                    <div class="component-title">Backend Server</div>
                    <div class="component-desc">
                        X√°c th·ª±c giao d·ªãch, c·∫≠p nh·∫≠t ƒë∆°n h√†ng, qu·∫£n l√Ω database
                    </div>
                </div>
            </div>
            
            <div class="note">
                <div class="note-title">üí° ƒêi·ªÉm quan tr·ªçng:</div>
                <div class="note-content">
                    <strong>Frontend kh√¥ng c·∫ßn backend key!</strong> Private key ch·ªâ n·∫±m trong MetaMask c·ªßa ng∆∞·ªùi d√πng. 
                    Website c·ªßa b·∫°n ch·ªâ c·∫ßn ƒë·ªãa ch·ªâ v√≠ nh·∫≠n ti·ªÅn (public address). Backend ch·ªâ d√πng ƒë·ªÉ x√°c th·ª±c 
                    giao d·ªãch ƒë√£ x·∫£y ra tr√™n blockchain, kh√¥ng tham gia k√Ω giao d·ªãch.
                </div>
            </div>
            
            <h2 style="margin: 40px 0 20px; color: #333;">üîÑ Lu·ªìng c∆° b·∫£n (5 b∆∞·ªõc ch√≠nh)</h2>
            
            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">Ng∆∞·ªùi d√πng ch·ªçn s·∫£n ph·∫©m & Checkout</div>
                        <div class="step-description">
                            Kh√°ch h√†ng th√™m s·∫£n ph·∫©m v√†o gi·ªè, ƒë·∫øn trang thanh to√°n, ch·ªçn ph∆∞∆°ng th·ª©c "Pay with Crypto"
                        </div>
                        <div class="step-actors">
                            <span class="actor frontend">Frontend</span>
                        </div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">K·∫øt n·ªëi MetaMask</div>
                        <div class="step-description">
                            Website y√™u c·∫ßu k·∫øt n·ªëi v√≠ ‚Üí MetaMask hi·ªán popup ‚Üí Ng∆∞·ªùi d√πng cho ph√©p k·∫øt n·ªëi 
                            ‚Üí Website nh·∫≠n ƒë·ªãa ch·ªâ v√≠ ng∆∞·ªùi d√πng (0x123...)
                        </div>
                        <div class="step-actors">
                            <span class="actor frontend">Frontend</span>
                            <span class="actor metamask">MetaMask</span>
                        </div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">T√≠nh to√°n s·ªë ti·ªÅn Crypto</div>
                        <div class="step-description">
                            L·∫•y gi√° ETH hi·ªán t·∫°i t·ª´ API (VD: CoinGecko) ‚Üí Chuy·ªÉn ƒë·ªïi USD sang ETH 
                            (VD: $100 / $3,500 = 0.0286 ETH) ‚Üí Hi·ªÉn th·ªã cho ng∆∞·ªùi d√πng
                        </div>
                        <div class="step-actors">
                            <span class="actor frontend">Frontend</span>
                        </div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <div class="step-title">Th·ª±c hi·ªán thanh to√°n</div>
                        <div class="step-description">
                            Website t·∫°o transaction ‚Üí MetaMask hi·ªán popup x√°c nh·∫≠n ‚Üí Ng∆∞·ªùi d√πng review (s·ªë ti·ªÅn, gas fee) 
                            ‚Üí X√°c nh·∫≠n ‚Üí MetaMask k√Ω v√† g·ª≠i l√™n blockchain ‚Üí Nh·∫≠n transaction hash
                        </div>
                        <div class="step-actors">
                            <span class="actor frontend">Frontend</span>
                            <span class="actor metamask">MetaMask</span>
                            <span class="actor blockchain">Blockchain</span>
                        </div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <div class="step-title">X√°c th·ª±c & Ho√†n t·∫•t</div>
                        <div class="step-description">
                            Frontend g·ª≠i transaction hash cho Backend ‚Üí Backend query blockchain ƒë·ªÉ x√°c th·ª±c 
                            (ƒë√∫ng ƒë·ªãa ch·ªâ, ƒë√∫ng s·ªë ti·ªÅn, ƒë√£ confirm) ‚Üí C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng ‚Üí 
                            G·ª≠i email x√°c nh·∫≠n ‚Üí Hi·ªÉn th·ªã th√†nh c√¥ng
                        </div>
                        <div class="step-actors">
                            <span class="actor frontend">Frontend</span>
                            <span class="actor backend">Backend</span>
                            <span class="actor blockchain">Blockchain</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab 2: Lu·ªìng chi ti·∫øt -->
        <div id="detailed-flow" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #333;">üîç Lu·ªìng chi ti·∫øt t·ª´ng b∆∞·ªõc</h2>
            
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <div class="timeline-title">üì± B∆∞·ªõc 1: Kh·ªüi t·∫°o k·∫øt n·ªëi Web3</div>
                        <div class="timeline-desc">
                            <strong>Frontend ki·ªÉm tra:</strong><br>
                            ‚Ä¢ window.ethereum c√≥ t·ªìn t·∫°i kh√¥ng? (MetaMask ƒë√£ c√†i?)<br>
                            ‚Ä¢ N·∫øu c√≥ ‚Üí Request quy·ªÅn truy c·∫≠p<br>
                            ‚Ä¢ N·∫øu kh√¥ng ‚Üí Hi·ªÉn th·ªã link c√†i ƒë·∫∑t MetaMask<br><br>
                            
                            <strong>MetaMask popup xu·∫•t hi·ªán:</strong><br>
                            ‚Ä¢ Hi·ªÉn th·ªã t√™n website ƒëang y√™u c·∫ßu<br>
                            ‚Ä¢ Ng∆∞·ªùi d√πng ch·ªçn account mu·ªën k·∫øt n·ªëi<br>
                            ‚Ä¢ Click "Connect" ho·∫∑c "Cancel"
                        </div>
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <div class="timeline-title">üí∞ B∆∞·ªõc 2: T·∫°o Order & T√≠nh gi√°</div>
                        <div class="timeline-desc">
                            <strong>Frontend g·ª≠i request ƒë·∫øn Backend:</strong><br>
                            POST /api/create-order<br>
                            Body: { items, totalUSD, customerEmail }<br><br>
                            
                            <strong>Backend x·ª≠ l√Ω:</strong><br>
                            ‚Ä¢ T·∫°o orderId unique<br>
                            ‚Ä¢ Query API l·∫•y gi√° ETH realtime<br>
                            ‚Ä¢ T√≠nh: ethAmount = totalUSD / ethPrice<br>
                            ‚Ä¢ L∆∞u v√†o database v·ªõi status: 'pending'<br>
                            ‚Ä¢ Set timeout (VD: 30 ph√∫t)<br><br>
                            
                            <strong>Response v·ªÅ Frontend:</strong><br>
                            { orderId, merchantAddress, ethAmount, expiresAt }
                        </div>
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <div class="timeline-title">üîê B∆∞·ªõc 3: T·∫°o Transaction</div>
                        <div class="timeline-desc">
                            <strong>Frontend s·ª≠ d·ª•ng Ethers.js:</strong><br>
                            ‚Ä¢ Chuy·ªÉn ƒë·ªïi ETH amount sang Wei (1 ETH = 10^18 Wei)<br>
                            ‚Ä¢ T·∫°o transaction object:<br>
                            &nbsp;&nbsp;- to: merchantAddress (ƒë·ªãa ch·ªâ v√≠ c·ªßa b·∫°n)<br>
                            &nbsp;&nbsp;- value: amountInWei<br>
                            &nbsp;&nbsp;- from: userAddress (t·ª± ƒë·ªông)<br>
                            &nbsp;&nbsp;- gas: t·ª± ƒë·ªông estimate<br><br>
                            
                            <strong>G·ªçi h√†m:</strong><br>
                            signer.sendTransaction(txObject)
                        </div>
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <div class="timeline-title">‚úçÔ∏è B∆∞·ªõc 4: Ng∆∞·ªùi d√πng x√°c nh·∫≠n</div>
                        <div class="timeline-desc">
                            <strong>MetaMask popup chi ti·∫øt:</strong><br>
                            ‚Ä¢ From: 0xABC... (ƒë·ªãa ch·ªâ ng∆∞·ªùi d√πng)<br>
                            ‚Ä¢ To: 0xXYZ... (ƒë·ªãa ch·ªâ merchant)<br>
                            ‚Ä¢ Amount: 0.0286 ETH ($100)<br>
                            ‚Ä¢ Gas fee: 0.0005 ETH (~$1.75)<br>
                            ‚Ä¢ Total: 0.0291 ETH<br><br>
                            
                            <strong>Ng∆∞·ªùi d√πng c√≥ 3 l·ª±a ch·ªçn:</strong><br>
                            1. Confirm ‚Üí K√Ω v√† g·ª≠i transaction<br>
                            2. Reject ‚Üí H·ªßy b·ªè<br>
                            3. Edit gas ‚Üí T√πy ch·ªânh ph√≠ (slow/standard/fast)
                        </div>
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <div class="timeline-title">‚õìÔ∏è B∆∞·ªõc 5: G·ª≠i l√™n Blockchain</div>
                        <div class="timeline-desc">
                            <strong>MetaMask th·ª±c hi·ªán:</strong><br>
                            ‚Ä¢ K√Ω transaction b·∫±ng private key (offline)<br>
                            ‚Ä¢ G·ª≠i signed transaction l√™n Ethereum node<br>
                            ‚Ä¢ Nh·∫≠n transaction hash ngay l·∫≠p t·ª©c<br>
                            ‚Ä¢ Hash n√†y l√† "bi√™n lai t·∫°m th·ªùi"<br><br>
                            
                            <strong>Transaction v√†o mempool:</strong><br>
                            ‚Ä¢ Ch·ªù miners/validators ƒë∆∞a v√†o block<br>
                            ‚Ä¢ Th·ªùi gian ch·ªù: 15 gi√¢y - 2 ph√∫t (t√πy gas)<br>
                            ‚Ä¢ Status: "Pending"
                        </div>
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <div class="timeline-title">‚úÖ B∆∞·ªõc 6: ƒê·ª£i Confirmations</div>
                        <div class="timeline-desc">
                            <strong>Block confirmation:</strong><br>
                            ‚Ä¢ Transaction ƒë∆∞·ª£c ƒë∆∞a v√†o block ‚Üí 1 confirmation<br>
                            ‚Ä¢ Block ti·∫øp theo ‚Üí 2 confirmations<br>
                            ‚Ä¢ C√†ng nhi·ªÅu confirmations = c√†ng an to√†n<br><br>
                            
                            <strong>Khuy·∫øn ngh·ªã:</strong><br>
                            ‚Ä¢ Ethereum: ƒê·ª£i √≠t nh·∫•t 12 confirmations<br>
                            ‚Ä¢ BSC: 15 confirmations<br>
                            ‚Ä¢ Polygon: 128 confirmations<br><br>
                            
                            <strong>Frontend tracking:</strong><br>
                            await tx.wait() // ƒê·ª£i 1 confirmation<br>
                            await tx.wait(12) // ƒê·ª£i 12 confirmations
                        </div>
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <div class="timeline-title">üîç B∆∞·ªõc 7: Backend x√°c th·ª±c</div>
                        <div class="timeline-desc">
                            <strong>Frontend g·ª≠i ƒë·∫øn Backend:</strong><br>
                            POST /api/verify-payment<br>
                            Body: { orderId, txHash, from, to, blockNumber }<br><br>
                            
                            <strong>Backend ki·ªÉm tra k·ªπ c√†ng:</strong><br>
                            1. Transaction c√≥ t·ªìn t·∫°i kh√¥ng?<br>
                            2. ƒê·ªãa ch·ªâ TO c√≥ ƒë√∫ng merchant wallet?<br>
                            3. S·ªë ti·ªÅn c√≥ kh·ªõp v·ªõi order? (cho ph√©p sai s·ªë 0.1%)<br>
                            4. Transaction ƒë√£ success? (status = 1)<br>
                            5. ƒê·ªß s·ªë confirmations ch∆∞a?<br>
                            6. Transaction n√†y ƒë√£ ƒë∆∞·ª£c d√πng cho order kh√°c ch∆∞a? (ch·ªëng double-spend)<br><br>
                            
                            <strong>N·∫øu pass t·∫•t c·∫£:</strong><br>
                            ‚Ä¢ Update order status: 'paid'<br>
                            ‚Ä¢ L∆∞u txHash v√†o database<br>
                            ‚Ä¢ Trigger fulfillment process<br>
                            ‚Ä¢ G·ª≠i email x√°c nh·∫≠n
                        </div>
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <div class="timeline-title">üéâ B∆∞·ªõc 8: Ho√†n t·∫•t</div>
                        <div class="timeline-desc">
                            <strong>Frontend nh·∫≠n response:</strong><br>
                            { success: true, order: {...} }<br><br>
                            
                            <strong>Hi·ªÉn th·ªã th√†nh c√¥ng:</strong><br>
                            ‚Ä¢ Show success message<br>
                            ‚Ä¢ Hi·ªÉn th·ªã transaction hash v·ªõi link Etherscan<br>
                            ‚Ä¢ Redirect ƒë·∫øn order confirmation page<br><br>
                            
                            <strong>Ng∆∞·ªùi d√πng c√≥ th·ªÉ:</strong><br>
                            ‚Ä¢ View transaction tr√™n Etherscan<br>
                            ‚Ä¢ Download invoice<br>
                            ‚Ä¢ Track order status
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="note">
                <div class="note-title">‚ö†Ô∏è X·ª≠ l√Ω l·ªói ph·ªï bi·∫øn:</div>
                <div class="note-content">
                    <strong>1. User reject transaction:</strong> Show message, cho ph√©p retry<br>
                    <strong>2. Insufficient funds:</strong> Check balance tr∆∞·ªõc khi g·ª≠i<br>
                    <strong>3. Gas too low:</strong> T·ª± ƒë·ªông estimate + buffer 10%<br>
                    <strong>4. Network congestion:</strong> Suggest higher gas ho·∫∑c ƒë·ª£i<br>
                    <strong>5. Wrong network:</strong> Detect chain ID, prompt user switch<br>
                    <strong>6. Transaction failed:</strong> L∆∞u log, cho ph√©p retry v·ªõi gas cao h∆°n
                </div>
            </div>
        </div>
        
        <!-- Tab 3: Ki·∫øn tr√∫c -->
        <div id="architecture" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #333;">üèóÔ∏è Ki·∫øn tr√∫c h·ªá th·ªëng</h2>
            
            <h3 style="color: #667eea; margin: 30px 0 15px;">1. Frontend Architecture</h3>
            <div class="code-example">
Website (React/Vue/Plain JS)
‚îú‚îÄ‚îÄ Web3 Provider (Ethers.js/Web3.js)
‚îú‚îÄ‚îÄ MetaMask Integration
‚îÇ   ‚îú‚îÄ‚îÄ Wallet Connection
‚îÇ   ‚îú‚îÄ‚îÄ Account Management
‚îÇ   ‚îî‚îÄ‚îÄ Transaction Signing
‚îú‚îÄ‚îÄ Price API Integration
‚îÇ   ‚îú‚îÄ‚îÄ CoinGecko API
‚îÇ   ‚îî‚îÄ‚îÄ Real-time price updates
‚îî‚îÄ‚îÄ UI Components
    ‚îú‚îÄ‚îÄ Connect Wallet Button
    ‚îú‚îÄ‚îÄ Payment Modal
    ‚îú‚îÄ‚îÄ Transaction Tracker
    ‚îî‚îÄ‚îÄ Success/Error Messages
            </div>
            
            <h3 style="color: #667eea; margin: 30px 0 15px;">2. Backend Architecture</h3>
            <div class="code-example">
Server (Node.js/Python/PHP)
‚îú‚îÄ‚îÄ API Endpoints
‚îÇ   ‚îú‚îÄ‚îÄ POST /api/create-order
‚îÇ   ‚îú‚îÄ‚îÄ POST /api/verify-payment
‚îÇ   ‚îî‚îÄ‚îÄ GET /api/order-status/:id
‚îú‚îÄ‚îÄ Blockchain Integration
‚îÇ   ‚îú‚îÄ‚îÄ Ethereum Node (Infura/Alchemy)
‚îÇ   ‚îú‚îÄ‚îÄ Transaction Verification
‚îÇ   ‚îî‚îÄ‚îÄ Event Monitoring
‚îú‚îÄ‚îÄ Database
‚îÇ   ‚îú‚îÄ‚îÄ Orders table
‚îÇ   ‚îú‚îÄ‚îÄ Transactions table
‚îÇ   ‚îî‚îÄ‚îÄ Payment logs
‚îî‚îÄ‚îÄ Background Jobs
    ‚îú‚îÄ‚îÄ Price update cron
    ‚îú‚îÄ‚îÄ Transaction monitoring
    ‚îî‚îÄ‚îÄ Order expiration cleanup
            </div>
            
            <h3 style="color: #667eea; margin: 30px 0 15px;">3. Data Flow</h3>
            <div class="code-example">
User Action ‚Üí Frontend ‚Üí MetaMask ‚Üí Blockchain
                ‚Üì
            Backend API
                ‚Üì
      Verify on Blockchain
                ‚Üì
         Update Database
                ‚Üì
          Notify Frontend
                ‚Üì
         Show Success UI
            </div>
            
            <h3 style="color: #667eea; margin: 30px 0 15px;">4. Security Layers</h3>
            
            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="step-number">üîí</div>
                    <div class="step-content">
                        <div class="step-title">Private Key Security</div>
                        <div class="step-description">
                            ‚Ä¢ Private key KH√îNG BAO GI·ªú r·ªùi kh·ªèi MetaMask<br>
                            ‚Ä¢ Website kh√¥ng th·ªÉ access private key<br>
                            ‚Ä¢ M·ªçi transaction ƒë·ªÅu c·∫ßn user confirmation<br>
                            ‚Ä¢ MetaMask encrypt private key v·ªõi password
                        </div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">üõ°Ô∏è</div>
                    <div class="step-content">
                        <div class="step-title">Transaction Validation</div>
                        <div class="step-description">
                            ‚Ä¢ Frontend validate tr∆∞·ªõc khi g·ª≠i (amount, address format)<br>
                            ‚Ä¢ Backend verify l·∫°i t·ª´ blockchain (kh√¥ng tin frontend)<br>
                            ‚Ä¢ Check transaction status, confirmations<br>
                            ‚Ä¢ Prevent double-spending (l∆∞u txHash ƒë√£ d√πng)
                        </div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">üîê</div>
                    <div class="step-content">
                        <div class="step-title">API Security</div>
                        <div class="step-description">
                            ‚Ä¢ HTTPS only (SSL certificate)<br>
                            ‚Ä¢ Rate limiting (prevent spam)<br>
                            ‚Ä¢ CORS properly configured<br>
                            ‚Ä¢ API authentication cho sensitive endpoints<br>
                            ‚Ä¢ Input validation & sanitization
                        </div>
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">‚õìÔ∏è</div>
                    <div class="step-content">
                        <div class="step-title">Blockchain Immutability</div>
                        <div class="step-description">
                            ‚Ä¢ Transaction tr√™n blockchain kh√¥ng th·ªÉ thay ƒë·ªïi<br>
                            ‚Ä¢ M·ªçi ng∆∞·ªùi c√≥ th·ªÉ verify tr√™n block explorer<br>
                            ‚Ä¢ Transparent v√† auditable<br>
                            ‚Ä¢ Kh√¥ng c·∫ßn trust third party
                        </div>
                    </div>
                </div>
            </div>
            
            <h3 style="color: #667eea; margin: 30px 0 15px;">5. Database Schema (ƒê·ªÅ xu·∫•t)</h3>
            <div class="code-example">
-- B·∫£ng Orders
CREATE TABLE orders (
    id VARCHAR(50) PRIMARY KEY,
    customer_email VARCHAR(255),
    total_usd DECIMAL(10,2),
    eth_amount DECIMAL(18,8),
    eth_price DECIMAL(10,2),
    merchant_address VARCHAR(42),
    status ENUM('pending', 'paid', 'expired', 'refunded'),
    expires_at TIMESTAMP,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

-- B·∫£ng Transactions
CREATE TABLE transactions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    order_id VARCHAR(50),
    tx_hash VARCHAR(66) UNIQUE,
    from_address VARCHAR(42),
    to_address VARCHAR(42),
    amount DECIMAL(18,8),
    block_number BIGINT,
    confirmations INT,
    status ENUM('pending', 'confirmed', 'failed'),
    verified_at TIMESTAMP,
    created_at TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(id)
);

-- B·∫£ng Payment Logs
CREATE TABLE payment_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    order_id VARCHAR(50),
    event_type VARCHAR(50),
    event_data JSON,
    created_at TIMESTAMP
);
            </div>
        </div>
        
        <!-- Tab 4: So s√°nh ph∆∞∆°ng th·ª©c -->
        <div id="comparison" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #333;">‚öñÔ∏è So s√°nh c√°c ph∆∞∆°ng th·ª©c thanh to√°n Crypto</h2>
            
            <h3 style="color: #667eea; margin: 30px 0 15px;">1. Direct Payment (Thanh to√°n tr·ª±c ti·∫øp)</h3>
            
            <table class="comparison-table">
                <tr>
                    <th style="width: 150px;">ƒê·∫∑c ƒëi·ªÉm</th>
                    <th>M√¥ t·∫£</th>
                </tr>
                <tr>
                    <td><strong>C√°ch ho·∫°t ƒë·ªông</strong></td>
                    <td>User chuy·ªÉn ETH/Token tr·ª±c ti·∫øp t·ª´ v√≠ c·ªßa h·ªç ƒë·∫øn v√≠ merchant</td>
                </tr>
                <tr>
                    <td><strong>∆Øu ƒëi·ªÉm</strong></td>
                    <td>
                        ‚úÖ ƒê∆°n gi·∫£n nh·∫•t, d·ªÖ implement<br>
                        ‚úÖ Kh√¥ng c·∫ßn smart contract<br>
                        ‚úÖ Gas fee th·∫•p nh·∫•t<br>
                        ‚úÖ Instant (sau khi confirm)
                    </td>
                </tr>
                <tr>
                    <td><strong>Nh∆∞·ª£c ƒëi·ªÉm</strong></td>
                    <td>
                        ‚ùå Kh√¥ng t·ª± ƒë·ªông<br>
                        ‚ùå Ph·∫£i manual verify m·ªói transaction<br>
                        ‚ùå Kh√≥ qu·∫£n l√Ω khi scale l·ªõn<br>
                        ‚ùå Kh√¥ng c√≥ escrow (kh√¥ng gi·ªØ ti·ªÅn t·∫°m)
                    </td>
                </tr>
                <tr>
                    <td><strong>Ph√π h·ª£p cho</strong></td>
                    <td>Website nh·ªè, startup, MVP, volume th·∫•p (< 100 orders/ng√†y)</td>
                </tr>
                <tr>
                    <td><strong>Chi ph√≠</strong></td>
                    <td>Gas fee: ~$1-5 (ETH), ~$0.1-0.5 (BSC/Polygon)</td>
                </tr>
            </table>
            
            <h3 style="color: #667eea; margin: 30px 0 15px;">2. Smart Contract Payment (Thanh to√°n qua Smart Contract)</h3>
            
            <table class="comparison-table">
                <tr>
                    <th style="width: 150px;">ƒê·∫∑c ƒëi·ªÉm</th>
                    <th>M√¥ t·∫£</th>
                </tr>
                <tr>
                    <td><strong>C√°ch ho·∫°t ƒë·ªông</strong></td>
                    <td>User g·ª≠i ti·ªÅn v√†o smart contract ‚Üí Contract verify ‚Üí Auto release cho merchant</td>
                </tr>
                <tr>
                    <td><strong>∆Øu ƒëi·ªÉm</strong></td>
                    <td>
                        ‚úÖ T·ª± ƒë·ªông h√≥a ho√†n to√†n<br>
                        ‚úÖ Escrow built-in (gi·ªØ ti·ªÅn t·∫°m)<br>
                        ‚úÖ C√≥ th·ªÉ refund t·ª± ƒë·ªông<br>
                        ‚úÖ Trustless (kh√¥ng c·∫ßn tin merchant)<br>
                        ‚úÖ H·ªó tr·ª£ multi-sig, time-lock
                    </td>
                </tr>
                <tr>
                    <td><strong>Nh∆∞·ª£c ƒëi·ªÉm</strong></td>
                    <td>
                        ‚ùå Ph·ª©c t·∫°p h∆°n nhi·ªÅu<br>
                        ‚ùå C·∫ßn vi·∫øt & audit smart contract<br>
                        ‚ùå Gas fee cao h∆°n (x2-3 l·∫ßn)<br>
                        ‚ùå Kh√≥ update logic sau khi deploy<br>
                        ‚ùå R·ªßi ro smart contract bugs
                    </td>
                </tr>
                <tr>
                    <td><strong>Ph√π h·ª£p cho</strong></td>
                    <td>Marketplace l·ªõn, escrow c·∫ßn thi·∫øt, high-value transactions</td>
                </tr>
                <tr>
                    <td><strong>Chi ph√≠</strong></td>
                    <td>
                        Deploy contract: $50-200<br>
                        M·ªói transaction: $3-15 (ETH), $0.3-1 (BSC/Polygon)
                    </td>
                </tr>
            </table>
            
            <h3 style="color: #667eea; margin: 30px 0 15px;">3. Payment Gateway (S·ª≠ d·ª•ng b√™n th·ª© 3)</h3>
            
            <table class="comparison-table">
                <tr>
                    <th style="width: 150px;">ƒê·∫∑c ƒëi·ªÉm</th>
                    <th>M√¥ t·∫£</th>
                </tr>
                <tr>
                    <td><strong>Nh√† cung c·∫•p</strong></td>
                    <td>Coinbase Commerce, BitPay, CoinPayments, NOWPayments</td>
                </tr>
                <tr>
                    <td><strong>∆Øu ƒëi·ªÉm</strong></td>
                    <td>
                        ‚úÖ Plug & play, r·∫•t d·ªÖ t√≠ch h·ª£p<br>
                        ‚úÖ H·ªó tr·ª£ nhi·ªÅu coin (BTC, ETH, USDT...)<br>
                        ‚úÖ Auto convert sang fiat (t√πy ch·ªçn)<br>
                        ‚úÖ Dashboard qu·∫£n l√Ω ƒë·∫ßy ƒë·ªß<br>
                        ‚úÖ Compliance & tax reporting<br>
                        ‚úÖ Customer support
                    </td>
                </tr>
                <tr>
                    <td><strong>Nh∆∞·ª£c ƒëi·ªÉm</strong></td>
                    <td>
                        ‚ùå Ph√≠ cao (1-2% m·ªói transaction)<br>
                        ‚ùå KYC required (ƒë·ªëi v·ªõi merchant)<br>
                        ‚ùå Ph·ª• thu·ªôc v√†o b√™n th·ª© 3<br>
                        ‚ùå √çt control h∆°n<br>
                        ‚ùå C√≥ th·ªÉ b·ªã banned/suspended
                    </td>
                </tr>
                <tr>
                    <td><strong>Ph√π h·ª£p cho</strong></td>
                    <td>Businesses mu·ªën nhanh, kh√¥ng c√≥ dev crypto, c·∫ßn support nhi·ªÅu coin</td>
                </tr>
                <tr>
                    <td><strong>Chi ph√≠</strong></td>
                    <td>1-2% per transaction + withdrawal fee</td>
                </tr>
            </table>
            
            <h3 style="color: #667eea; margin: 30px 0 15px;">4. So s√°nh t·ªïng quan</h3>
            
            <table class="comparison-table">
                <tr>
                    <th>Ti√™u ch√≠</th>
                    <th>Direct Payment</th>
                    <th>Smart Contract</th>
                    <th>Payment Gateway</th>
                </tr>
                <tr>
                    <td><strong>ƒê·ªô ph·ª©c t·∫°p</strong></td>
                    <td>‚≠ê D·ªÖ</td>
                    <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê R·∫•t kh√≥</td>
                    <td>‚≠ê‚≠ê Trung b√¨nh</td>
                </tr>
                <tr>
                    <td><strong>Chi ph√≠</strong></td>
                    <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Th·∫•p nh·∫•t</td>
                    <td>‚≠ê‚≠ê‚≠ê Trung b√¨nh</td>
                    <td>‚≠ê‚≠ê Cao (1-2%)</td>
                </tr>
                <tr>
                    <td><strong>T·ªëc ƒë·ªô t√≠ch h·ª£p</strong></td>
                    <td>1-2 ng√†y</td>
                    <td>1-2 tu·∫ßn</td>
                    <td>V√†i gi·ªù</td>
                </tr>
                <tr>
                    <td><strong>B·∫£o m·∫≠t</strong></td>
                    <td>‚≠ê‚≠ê‚≠ê‚≠ê T·ªët</td>
                    <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê R·∫•t t·ªët</td>
                    <td>‚≠ê‚≠ê‚≠ê‚≠ê T·ªët</td>
                </tr>
                <tr>
                    <td><strong>Control</strong></td>
                    <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Full control</td>
                    <td>‚≠ê‚≠ê‚≠ê‚≠ê High control</td>
                    <td>‚≠ê‚≠ê Limited</td>
                </tr>
                <tr>
                    <td><strong>Scalability</strong></td>
                    <td>‚≠ê‚≠ê Limited</td>
                    <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excellent</td>
                    <td>‚≠ê‚≠ê‚≠ê‚≠ê Very good</td>
                </tr>
            </table>
            
            <div class="note">
                <div class="note-title">üí° Khuy·∫øn ngh·ªã:</div>
                <div class="note-content">
                    <strong>B·∫Øt ƒë·∫ßu v·ªõi Direct Payment n·∫øu:</strong><br>
                    ‚Ä¢ B·∫°n l√† startup/side project<br>
                    ‚Ä¢ Volume th·∫•p (< 100 orders/ng√†y)<br>
                    ‚Ä¢ Mu·ªën t·ª± h·ªçc v√† control ho√†n to√†n<br>
                    ‚Ä¢ Budget h·∫°n ch·∫ø<br><br>
                    
                    <strong>D√πng Payment Gateway n·∫øu:</strong><br>
                    ‚Ä¢ C·∫ßn nhanh, kh√¥ng c√≥ th·ªùi gian dev<br>
                    ‚Ä¢ Mu·ªën h·ªó tr·ª£ nhi·ªÅu cryptocurrency<br>
                    ‚Ä¢ C·∫ßn convert sang fiat t·ª± ƒë·ªông<br>
                    ‚Ä¢ OK v·ªõi ph√≠ 1-2%<br><br>
                    
                    <strong>Smart Contract ch·ªâ khi:</strong><br>
                    ‚Ä¢ B·∫°n c√≥ dev blockchain experience<br>
                    ‚Ä¢ C·∫ßn escrow/refund t·ª± ƒë·ªông<br>
                    ‚Ä¢ High volume v√† c·∫ßn automation<br>
                    ‚Ä¢ Budget ƒë·ªÉ audit contract
                </div>
            </div>
            
            <h3 style="color: #667eea; margin: 30px 0 15px;">5. Chi ph√≠ th·ª±c t·∫ø (V√≠ d·ª• 100 orders/ng√†y)</h3>
            
            <table class="comparison-table">
                <tr>
                    <th>Ph∆∞∆°ng th·ª©c</th>
                    <th>Setup Cost</th>
                    <th>Monthly Cost</th>
                    <th>Per Transaction</th>
                    <th>Total/month</th>
                </tr>
                <tr>
                    <td><strong>Direct (ETH)</strong></td>
                    <td>$0</td>
                    <td>$0</td>
                    <td>$2 gas</td>
                    <td>$6,000</td>
                </tr>
                <tr>
                    <td><strong>Direct (Polygon)</strong></td>
                    <td>$0</td>
                    <td>$0</td>
                    <td>$0.1 gas</td>
                    <td>$300</td>
                </tr>
                <tr>
                    <td><strong>Smart Contract (ETH)</strong></td>
                    <td>$100-500</td>
                    <td>$0</td>
                    <td>$5 gas</td>
                    <td>$15,000</td>
                </tr>
                <tr>
                    <td><strong>Payment Gateway</strong></td>
                    <td>$0</td>
                    <td>$0</td>
                    <td>1% + $0.5 gas</td>
                    <td>T√πy revenue</td>
                </tr>
            </table>
            
            <div style="margin-top: 20px; padding: 20px; background: #e7f3ff; border-radius: 10px; border-left: 4px solid #007bff;">
                <strong>üí∞ L∆∞u √Ω v·ªÅ chi ph√≠:</strong><br>
                ‚Ä¢ Gas fee thay ƒë·ªïi theo network congestion<br>
                ‚Ä¢ Polygon/BSC r·∫ª h∆°n ETH mainnet 100-1000 l·∫ßn<br>
                ‚Ä¢ Layer 2 solutions (Arbitrum, Optimism) r·∫ª h∆°n 10-50 l·∫ßn<br>
                ‚Ä¢ Users tr·∫£ gas fee, kh√¥ng ph·∫£i merchant<br>
                ‚Ä¢ N√™n c√≥ option cho user ch·ªçn network ƒë·ªÉ ti·∫øt ki·ªám
            </div>
        </div>
    </div>

    <script>
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }
    </script>
</body>
</html>